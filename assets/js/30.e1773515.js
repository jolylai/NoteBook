(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{443:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("Badge",{attrs:{text:"2.3.0+ 中支持"}}),t._v(" "),a("p",[t._v("在 umi 中，区块是指页面级别的可复用的代码。umi 定义了一个区块的规范，你可以通过 umi 能够快速简单的在你的项目中添加区块，用于快速的开始一个页面的开发。")]),t._v(" "),t._m(1),t._v(" "),a("p",[t._v("在项目根目录使用如下命令可以添加一个区块到到你的项目中：")]),t._v(" "),t._m(2),t._m(3),t._v(" "),t._m(4),t._v(" "),a("p",[t._v("比如，你可以运行：")]),t._v(" "),t._m(5),a("p",[t._v("来将官方的区块仓库中的 demo 区块下载到你的项目本地。对于"),a("a",{attrs:{href:"https://github.com/umijs/umi-blocks",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方区块仓库"),a("OutboundLink")],1),t._v("下的区块你可以使用更加简洁的命令，比如 "),a("code",[t._v("umi block add demo")]),t._v(" 来下载区块。")]),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),a("p",[t._v("需要注意的是，区块只是用于开发时新建页面时的提效工具，一般来说区块要实际应用都需要针对项目需求去修改最后的代码，之后的维护都将和普通页面一样由开发者来维护，不存在区块更新的说法。")]),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),a("p",[t._v("你可以通过 "),a("a",{attrs:{href:"https://github.com/umijs/create-umi",target:"_blank",rel:"noopener noreferrer"}},[t._v("create-umi"),a("OutboundLink")],1),t._v(" 快速创建一个区块的模板：")]),t._v(" "),t._m(11),a("p",[t._v("区块的目录结构如下：")]),t._v(" "),t._m(12),a("p",[t._v("其中 package.json 文件相关内容如下：")]),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),a("p",[t._v("另外，如果在项目中配置了 singular 为 true，那么这个处理过程也会将对应的复数目录改为单数。")]),t._v(" "),t._m(17),t._v(" "),a("p",[t._v("为了避免区块添加到应用中出现冲突，umi 提供了一些宏，当区块被添加到项目中时，区块代码中的宏也会按照区块对应的信息被替换。通过这个能力可以避免诸如 dva model 的 namespace 冲突等问题。")]),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),a("p",[t._v("区块调试基于 "),a("a",{attrs:{href:"https://github.com/umijs/umi-plugin-block-dev",target:"_blank",rel:"noopener noreferrer"}},[t._v("umi-plugin-block-dev"),a("OutboundLink")],1),t._v(" 这个插件，基于该插件你就可以把区块当做一个普通的 umi 项目来调试了。如下所示，在区块的根目录下添加 "),a("code",[t._v(".umirc.js")]),t._v(" 文件（通过 "),a("code",[t._v("create-umi")]),t._v(" 创建的区块脚手架会自带该文件）。")]),t._v(" "),t._m(21),t._m(22),t._v(" "),a("p",[t._v("如果你觉得的区块质量较好，你可以通过提交 PR 来把它添加到 "),a("a",{attrs:{href:"https://github.com/umijs/umi-blocks",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方区块仓库"),a("OutboundLink")],1),t._v(" 中。")])],1)},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"区块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 区块")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"使用区块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用区块")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ umi block add "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("block url"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  --path"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("target path"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 添加空白模块")]),t._v("\n$ umi block add https://github.com/umijs/umi-blocks/tree/master/blank\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 添加登录区块")]),t._v("\n$ umi block add https://github.com/umijs/umi-blocks/tree/master/ant-design-pro/UserLogin\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("其中 "),s("code",[this._v("[block url]")]),this._v(" 可以是一个 Github 或者 Gitlab 地址，也可以是一个 Git 仓库地址，也可以是一个本地相对或者绝对路径。只要对应的路径下是一个区块的代码，满足 umi 区块的规范，那么 umi 就可以通过该命令将区块的代码下载到你的项目中。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("[target path]")]),this._v(" 是你要把区块添加到的路径。如果已经这个路径下已经存在路由组件，那么 umi 会把区块添加到它里面。如果没有那么 umi 会先创建一个路由组件，然后再把区块添加进去。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ umi block add https://github.com/umijs/umi-blocks/tree/master/demo\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果你的项目正在本地调试，那么区块下载到项目中后你就可以访问相应的路径来查看效果了。区块代码会被默认下载到 pages/[name] 下面，其中 name 是默认取区块中的 "),s("code",[this._v("package.json")]),this._v(" 中的 name 字段（会去掉"),s("code",[this._v("/")]),this._v("前的无效片段）。对于配置式路由，我们也会默认添加路由配置到你的配置中，所以也一样可以直接访问。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("你可以通过 "),s("code",[this._v("umi help block")]),this._v(" 来查看支持的更多配置。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("blockquote",[a("p",[t._v("注：在 umi 2.7 之前，同一个路径下只能添加一个区块，区块会作为整个页面的代码添加到你的项目中。在 2.7 及它之后我们支持重复添加区块，或者添加到当前项目中已有的页面中。对于原因的区块你可以通过在区块的 "),a("code",[t._v("package.json")]),t._v(" 中配置 "),a("code",[t._v("blockConfig.specVersion")]),t._v(" 为 "),a("code",[t._v("0.1")]),t._v(" 来兼容或者通过 "),a("code",[t._v("--mode")]),t._v(" 来指定添加的方式。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"区块开发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#区块开发","aria-hidden":"true"}},[this._v("#")]),this._v(" 区块开发")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"初始化区块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 初始化区块")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ yarn create umi --block\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("- root\n  - src              // 区块的代码\n    - index.js       // 区块入口，需要默认导出一个 React 组件\n    - _mock.js       // 约定的 mock 文件\n  - package.json     // 区块依赖等信息\n  - .umirc.js        // 基于 umi 开发区块时的配置\n  - thumb.[png|jpg]  // 区块的缩略图\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'@umi-blocks/demo'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  description"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'区块描述'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// ... 更多其他 npm 包的相关定义")]),t._v("\n  dependencies"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// dependencies 里面是区块运行时阶段的依赖，比如 antd g2 这些包的依赖")]),t._v("\n    antd"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'^3.0.0'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  devDependencies"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 用户调试区块时候的依赖，和区块没有直接关系，可以提供基于 umi 的开发方案")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  scripts"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 开发区块调试时的命令，和区块没有直接关系")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"区块添加逻辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#区块添加逻辑","aria-hidden":"true"}},[this._v("#")]),this._v(" 区块添加逻辑")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("当执行 "),s("code",[this._v("umi block add [block url]")]),this._v(" 的时候实际上是执行的如下步骤：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("通过 git clone 下载区块代码（如果已经存在则会通过 git pull 更新）")]),this._v(" "),s("li",[this._v("检测区块的 package.json 中的依赖并自动安装到项目中")]),this._v(" "),s("li",[this._v("将区块代码复制到对应的页面目录，复制过程中会做一些宏替换")]),this._v(" "),s("li",[this._v("如果是配置式路由，那么会自动添加路由")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"宏替换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#宏替换","aria-hidden":"true"}},[this._v("#")]),this._v(" 宏替换")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("具体的宏如下，基于 "),s("code",[this._v("--path=/Test_Hello/hello-Block")]),this._v(" 示例。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("ROUTE_PATH "),a("code",[t._v("/test_hello/hello-block")])]),t._v(" "),a("li",[t._v("BLOCK_NAME "),a("code",[t._v("test_hello-hello-block")])]),t._v(" "),a("li",[t._v("PAGE_NAME "),a("code",[t._v("hello-block")])]),t._v(" "),a("li",[t._v("PAGE_NAME_UPPER_CAMEL_CASE "),a("code",[t._v("HelloBlock")])]),t._v(" "),a("li",[t._v("BLOCK_NAME_CAMEL_CASE "),a("code",[t._v("testHelloHelloBlock")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"区块调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#区块调试","aria-hidden":"true"}},[this._v("#")]),this._v(" 区块调试")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{attrs:{class:"token string"}},[t._v('"umi-plugin-block-dev"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        layout"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"ant-design-pro"')]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("该插件会将区块的 src 目录作为 umi 的 pages 目录，这样你就可以在区块根目录下通过 "),s("code",[this._v("umi dev")]),this._v(" 来开发调试区块了。")])}],!1,null,null,null);s.default=e.exports}}]);