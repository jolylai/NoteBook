(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{398:function(s,a,n){"use strict";n.r(a);var t=n(0),e=Object(t.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务器","aria-hidden":"true"}},[s._v("#")]),s._v(" 服务器")]),s._v(" "),n("h2",{attrs:{id:"服务器配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务器配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 服务器配置")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装ruby")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ruby\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里请翻墙一下")]),s._v("\n$ gem update --system\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看版本号")]),s._v("\n$ gem -v\n2.6.3\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换镜像源")]),s._v("\n$ gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是切换成功")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确保只有 gems.ruby-china.com")]),s._v("\n$ gem sources -l\nhttps://gems.ruby-china.com\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 travis")]),s._v("\n$ gem "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" travis\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h2",{attrs:{id:"ssh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ssh","aria-hidden":"true"}},[s._v("#")]),s._v(" ssh")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ssh-keygen -t rsa "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后一路回车即可")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id 可能需要另行安装")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果ssh默认端口是22，则不需要 -p")]),s._v("\nssh-copy-id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("登录部署服务器用户名"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("部署服务器地址"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -p "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("部署服务器ssh端口"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试是否可以用ssh登录服务器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("登录部署服务器用户名"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("部署服务器地址"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -p "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("部署服务器ssh端口"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"加密私钥到-travis-环境变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#加密私钥到-travis-环境变量","aria-hidden":"true"}},[s._v("#")]),s._v(" 加密私钥到 travis 环境变量")]),s._v(" "),n("p",[s._v("切换目录到项目根路径下")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --auto自动登录github帐号")]),s._v("\n$ travis login --auto\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此处的--add参数表示自动添加脚本到.travis.yml文件中")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个命令会自动把 id_rsa 加密传送到 .git 指定的仓库对应的 travis 中去")]),s._v("\n$ travis encrypt-file ~/.ssh/id_rsa --add\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"ssh-known-hosts"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ssh-known-hosts","aria-hidden":"true"}},[s._v("#")]),s._v(" ssh known_hosts")]),s._v(" "),n("p",[s._v("因为 travis-ci 默认只添加了 github.com, gist.github.com 和 ssh.github.com 为 known_hosts，rsync 执行时会提示是否添加，但是 travis-ci 里不能输入确认，所以需要将自动服务器的域名和商品添加到 known_hosts")]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("addons:\n  ssh_known_hosts: uedsky.com:1223\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"上传文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#上传文件","aria-hidden":"true"}},[s._v("#")]),s._v(" 上传文件")]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 没有修改过端口的，可以用这个，上传目录要加 -r 参数\n- scp -o stricthostkeychecking=no -r 要上传的文件或目录 用户@域名或IP:/路径\n# 由于我修改了默认的port，所以在这里也进行了加密处理\n- scp -o stricthostkeychecking=no -P $PORT -r 要上传的文件或目录 用户@域名或IP:/路径\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("最后，就是在 after_success 周期中，添加上传服务器的指令即可，在这里要注意，如果没有 stricthostkeychecking=no 参数，将构建失败，详细原因请参考通过 travis 部署代码到远程服务器")]),s._v(" "),n("h2",{attrs:{id:"示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例","aria-hidden":"true"}},[s._v("#")]),s._v(" 示例")]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('language: node_js\nnode_js: 8\nbranches:\n  only:\n    - master\naddons:\n  ssh_known_hosts: 106.12.140.131\ninstall:\n  - yarn install\nscript:\n  - yarn run docs:build\ndeploy:\n  provider: pages\n  skip-cleanup: true\n  github-token: "$GITHUB_TOKEN"\n  keep-history: true\n  local_dir: docs/.vuepress/dist\n  on:\n    branch: master\nbefore_install:\n  - openssl aes-256-cbc -K $encrypted_2a01126f8b17_key -iv $encrypted_2a01126f8b17_iv\n    -in id_rsa.enc -out ~/.ssh/id_rsa -d\n  - chmod 600 ~/.ssh/id_rsa\n  - echo -e "Host 106.12.140.131\\n\\tStrictHostKeyChecking no\\n" >> ~/.ssh/config\nafter_success:\n  - scp -o stricthostkeychecking=no -r docs/.vuepress/dist root@106.12.140.131:/root\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])])])}],!1,null,null,null);a.default=e.exports}}]);